---
import { getCollection } from 'astro:content';
import BaseLayout from './BaseLayout.astro';

export async function getStaticPaths() {
	const retrospectives = await getCollection('retrospectives');
	return retrospectives.map((ret) => ({
		params: { slug: ret.slug },
		props: { entry: ret },
	}));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const idPath = entry.id.replace(/\\/g, '/');
const slugRaw = idPath.split('/').pop() ?? entry.id;
const slug = slugRaw.replace(/\.md$/i, '') || entry.slug || slugRaw;
const pageId = `kmsk99.github.io.retrospective.${slug}`;
const badgeSrc = `https://visitor-badge.laobi.icu/badge?page_id=${encodeURIComponent(pageId)}`;
const breadcrumbs = [
	{ label: '홈', url: '/' },
	{ label: '회고', url: '/retrospectives/' },
	{ label: entry.data.title, url: Astro.url?.pathname ?? `/post/${slug}` },
];
---

<BaseLayout
	title={entry.data.title}
	description={entry.data.summary}
	seoType="article"
	publishedTime={entry.data.created}
	modifiedTime={entry.data.modified}
	breadcrumbs={breadcrumbs}
>
	<article class="article">
		<div class="article__meta">
			<p class="eyebrow">Retrospective · {entry.data.created}</p>
			<div class="visitor-badge" aria-label="방문자 수 배지">
				<img src={badgeSrc} alt={`${entry.data.title} 방문자 수`} loading="lazy" decoding="async" />
			</div>
		</div>
		<h1>{entry.data.title}</h1>
		<div class="article__body">
			<Content />
		</div>
	</article>
</BaseLayout>

