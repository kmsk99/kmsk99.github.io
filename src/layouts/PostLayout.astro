---
import BaseLayout from './BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
	entry: CollectionEntry<'posts'>;
}

const { entry } = Astro.props as Props;
const { Content } = await entry.render();
const idPath = entry.id.replace(/\\/g, '/');
const slugRaw = idPath.split('/').pop() ?? entry.id;
const slug = slugRaw.replace(/\.md$/i, '') || entry.slug || slugRaw;
const pageId = `kmsk99.github.io.post.${slug}`;
const badgeSrc = `https://visitor-badge.laobi.icu/badge?page_id=${encodeURIComponent(pageId)}`;
const breadcrumbs = [
	{ label: '홈', url: '/' },
	{ label: '포스트', url: '/posts/' },
	{ label: entry.data.title, url: Astro.url?.pathname ?? `/post/${slug}` },
];
---

<BaseLayout
	title={entry.data.title}
	description={entry.data.summary}
	seoType="article"
	publishedTime={entry.data.created}
	modifiedTime={entry.data.modified}
	tags={entry.data.tags}
	breadcrumbs={breadcrumbs}
>
	<article class="article">
		<div class="article__meta">
			<p class="eyebrow">Post · {entry.data.created}</p>
			<div class="visitor-badge" aria-label="방문자 수 배지">
				<img src={badgeSrc} alt={`${entry.data.title} 방문자 수`} loading="lazy" decoding="async" />
			</div>
		</div>
		<h1>{entry.data.title}</h1>
		{entry.data.tags && (
			<div class="chips">
				{entry.data.tags.map((tag) => {
					const params = new URLSearchParams({ tag, type: 'post' }).toString();
					return (
						<a class="chip" href={`/?${params}`} aria-label={`태그 ${tag}로 이동`}>
							{tag}
						</a>
					);
				})}
			</div>
		)}
		<div class="article__body">
			<Content />
		</div>
	</article>
</BaseLayout>

