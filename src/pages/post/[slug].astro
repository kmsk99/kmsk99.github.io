---
import { getCollection } from 'astro:content';
import PostLayout from '../../layouts/PostLayout.astro';
import ProjectLayout from '../../layouts/ProjectLayout.astro';
import RetrospectiveLayout from '../../layouts/RetrospectiveLayout.astro';

export async function getStaticPaths() {
	const collections = [
		...(await getCollection('posts')),
		...(await getCollection('projects')),
		...(await getCollection('retrospectives')),
	];

	const seen = new Set<string>();
	const paths = [];

	for (const entry of collections) {
		const segments = entry.id.split('/');
		const slugRaw = segments[segments.length - 1];
		const slug = slugRaw.replace(/\.md$/i, '');

		if (!slug) continue;
		if (seen.has(slug)) continue;
		seen.add(slug);

		paths.push({
			params: { slug },
			props: { entry },
		});

		// .md로 끝나는 기존 링크가 있을 경우 호환 경로도 함께 생성
		if (slugRaw.endsWith('.md') && !seen.has(slugRaw)) {
			seen.add(slugRaw);
			paths.push({
				params: { slug: slugRaw },
				props: { entry },
			});
		}
	}

	return paths;
}

const { entry } = Astro.props;
---

{entry.collection === 'projects' ? (
	<ProjectLayout entry={entry as any} />
) : entry.collection === 'retrospectives' ? (
	<RetrospectiveLayout entry={entry as any} />
) : (
	<PostLayout entry={entry as any} />
)}

